<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.nome or 'Utente' }} - Helpy</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/profile.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <img src="https://i.imgur.com/4M34hi2.png" alt="Helpy Logo" class="navbar-logo" style="height:32px;">
            <span class="navbar-title">Helpy</span>
        </div>
        <div class="navbar-links">
            <a href="/">Home</a>
            {% if user %}
                <a href="/profile" class="register-btn">üë§ {{ user.nome }}</a>
                <a href="/logout" class="register-btn" style="background: #e74c3c; margin-left: 8px;">Logout</a>
            {% else %}
                <a href="/login" class="register-btn" style="background: #1746a2; margin-right: 8px;">Login</a>
                <a href="/register" class="register-btn">Registrati</a>
            {% endif %}
        </div>
    </nav>

    <div class="profile-container">
        <main class="main-content">
            <!-- Cover Image -->
            <div class="cover-image"></div>
            
            <!-- Profile Header -->
            <header class="profile-header card">
                <!-- üî• FOTO PROFILO O AVATAR DEFAULT -->
                {% if user.profile_picture %}
                <img src="{{ user.profile_picture }}" alt="{{ user.nome }}" class="profile-avatar-large">
                {% else %}
                <div class="profile-avatar-large">
                    {{ category.icon if category else 'üë§' }}
                </div>
                {% endif %}
                
                <div class="info">
                    <h1>{{ user.nome or 'Nome non disponibile' }}</h1>
                    <p>{{ user.professione or 'Professionista' }}</p>
                    <small style="color: #888;">Membro dal {{ user.created_at[:10] if user.created_at else 'N/A' }}</small>
                    {% if is_own_profile %}
                    <a href="/profile" class="btn-edit">‚úèÔ∏è Modifica il tuo profilo</a>
                    {% endif %}
                </div>
            </header>

            <!-- Description Section -->
            <section class="card">
                <h2>Descrizione</h2>
                {% if user.descrizione %}
                <p>{{ user.descrizione }}</p>
                {% else %}
                <p style="color:#888;">{{ user.nome or 'Questo utente' }} non ha ancora aggiunto una descrizione al profilo.</p>
                {% endif %}
            </section>

            <!-- Areas of Interest -->
            <section class="card">
                <h2>Aree di Interesse</h2>
                {% if aree_interesse_list %}
                <ul>
                    {% for area in aree_interesse_list %}
                    <li>{{ area.strip() }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p style="color:#888;">Nessuna area di interesse specificata.</p>
                {% endif %}
            </section>

            <!-- Skills / Macro Areas -->
            <section class="card">
                <h2>Competenze</h2>
                <div class="skills-container">
                    {% if macro_aree_list %}
                        {% for skill in macro_aree_list %}
                        <span class="skill-tag">{{ skill.strip() }}</span>
                        {% endfor %}
                    {% else %}
                        <p style="color:#888;">Nessuna competenza specificata.</p>
                    {% endif %}
                </div>
            </section>
            
            <!-- Reviews Section -->
            <section class="card">
                <h2>Recensioni e Voti</h2>
                <p style="color:#888;">Nessuna recensione disponibile al momento.</p>
                <!-- Qui in futuro aggiungeremo le recensioni reali -->
            </section>

            <!-- Category Badge -->
            {% if category %}
            <section class="card">
                <h2>Categoria</h2>
                <div class="category-badge" style="background:{{ category.color }}20; border-left:4px solid {{ category.color }}; padding:16px; border-radius:8px;">
                    <div style="font-size:2em; margin-bottom:8px;">{{ category.icon }}</div>
                    <h3 style="margin:0 0 8px 0; color:{{ category.color }};">{{ category.name }}</h3>
                    <p style="margin:0; color:#666;">{{ category.description }}</p>
                    {% if category.target %}
                    <small style="color:#888; display:block; margin-top:8px;"><strong>Target:</strong> {{ category.target }}</small>
                    {% endif %}
                </div>
            </section>
            {% endif %}
        </main>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Consultation Booking Card -->
            <section class="consultation-card">
                <h2>Richiedi una Consulenza</h2>
                <div class="price">‚Ç¨{{ user.prezzo_consulenza or 150 }} <span>/ {{ user.durata_consulenza or 60 }} min</span></div>
                
                <ul>
                    <li>Consulenza personalizzata 1-on-1</li>
                    <li>Sessione Q&A illimitata</li>
                    <li>Follow-up via email</li>
                    <li>Materiali di supporto inclusi</li>
                </ul>

                {% if is_own_profile %}
                <div class="btn btn-secondary" style="cursor: not-allowed; opacity: 0.6;">Non puoi prenotare te stesso</div>
                {% elif not user %}
                <a href="/login?redirect=/user/{{ user.id }}" class="btn btn-primary">Accedi per Prenotare</a>
                <p>Devi essere loggato per richiedere una consulenza</p>
                {% else %}
                <a href="/book/{{ user.id }}" class="btn btn-primary">Prenota Ora</a>
                <p>Verrai reindirizzato al calendario per scegliere la data.</p>
                {% endif %}
            </section>
            
            <!-- Stats Card -->
            <section class="card">
                <h3>Statistiche</h3>
                
                <div class="stat-item">
                    <div class="stat-label">Consulenze Vendute</div>
                    <div class="stat-value">{{ user.consulenze_vendute }}</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">Valutazione Media</div>
                    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p style="margin:5px 0 0 0; font-size:0.9em; color:#888;">(0 recensioni)</p>
                </div>
            </section>

            <!-- Messaging Card -->
            {% if not is_own_profile and current_user %}
            <section class="card">
                <h3>Messaggistica</h3>
                <p style="text-align:center; color: #555; font-size:0.95em; margin-bottom:16px;">Puoi inviare un messaggio per domande veloci prima di prenotare.</p>
                <a href="/messages/{{ user.id }}" class="btn btn-secondary">Invia Messaggio</a>
            </section>
            {% endif %}
        </aside>
    </div>
</body>
</html>